<!DOCTYPE html>
<html>
<title>NHL Game Report Launcher</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
.mb-compact {
    margin-top: 4px;
    margin-bottom: 4px;
}
</style>

<script>
var season = "20222023";
const PRESEASON = "01";
const REGULAR_SEASON = "02";
const PLAYOFFS = "03";

// use this to indicate which part of the season we are using
var part = REGULAR_SEASON;

function launchReports() {
	var x = document.forms["reports"]["gsRptCk"].checked;
	var gameNum = numberFormat( document.forms["reports"]["gameNumber"].value );

	if( gameNum == "0000" ) {
		alert( "Please provide a game number" );
		throw( "arg missing" );
	}

	if( document.forms["reports"]["gsRptCk"].checked ) {
		launchGS( gameNum );
	}
	if( document.forms["reports"]["esRptCk"].checked ) {
		launchES( gameNum );
	}
	if( document.forms["reports"]["plRptCk"].checked ) {
		launchPL( gameNum );
	}
	if( document.forms["reports"]["fsRptCk"].checked ) {
		launchFS( gameNum );
	}
	if( document.forms["reports"]["fcRptCk"].checked ) {
		launchFC( gameNum );
	}
	if( document.forms["reports"]["roRptCk"].checked ) {
		launchRO( gameNum );
	}
	if( document.forms["reports"]["tvRptCk"].checked ) {
		launchTV( gameNum );
	}
	if( document.forms["reports"]["thRptCk"].checked ) {
		launchTH( gameNum );
	}
	if( document.forms["reports"]["ssRptCk"].checked ) {
		launchSS( gameNum );
	}
	if( document.forms["reports"]["scRptCk"].checked ) {
		launchSC( gameNum );
	}
	if( document.forms["reports"]["soRptCk"].checked ) {
		launchSO( gameNum );
	}
}

function numberFormat( i ) {
	var fmt = "" + i;
	for( ; fmt.length < 4; fmt = "0" + fmt );
	return fmt;
}




function launchGS( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/GS" + part + gameNumber + ".HTM" );
}

function launchES( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/ES" + part + gameNumber + ".HTM" );
}

function launchPL( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/PL" + part + gameNumber + ".HTM" );
}

function launchFS( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/FS" + part + gameNumber + ".HTM" );
}

function launchFC( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/FC" + part + gameNumber + ".HTM" );
}

function launchRO( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/RO" + part + gameNumber + ".HTM" );
}

function launchTH( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/TH" + part + gameNumber + ".HTM" );
}

function launchTV( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/TV" + part + gameNumber + ".HTM" );
}

function launchSS( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/SS" + part + gameNumber + ".HTM" );
}

function launchSC( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/stats/shiftcharts?id=2019" + part + gameNumber );
}

function launchSO( gameNumber ) {
	//var randomnumber = Math.floor((Math.random()*100)+1);
	window.open( "http://www.nhl.com/scores/htmlreports/" + season + "/SO" + part + gameNumber + ".HTM" );
}


function selectAll() {
	document.forms["reports"]["gsRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["esRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["plRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["fsRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["fcRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["roRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["tvRptCk"].checked = document.forms["reports"]["allCk"].checked;
	document.forms["reports"]["thRptCk"].checked = document.forms["reports"]["allCk"].checked;
	//document.forms["reports"]["ssRptCk"].checked = document.forms["reports"]["allCk"].checked;
	//document.forms["reports"]["scRptCk"].checked = document.forms["reports"]["allCk"].checked;
	//document.forms["reports"]["soRptCk"].checked = document.forms["reports"]["allCk"].checked;
}

</script>
<body>


<div class="w3-row">

	<div class="w3-container ">
		<p id="gameList">
	</div>




	<div class="w3-container ">




	<label>Game Number:</label>
	<div class="w3-bar">
		<input class="w3-input w3-border w3-bar-item" type="text" style="width:30%" name="gameNumber">

		<button type="button" onclick="launchReports()" class="w3-button w3-bar-item w3-ripple w3-light-grey w3-round-large w3-border w3-border-black">
			Launch
		</button>
	</div>


<form name="reports" class="w3-container" action="noPage">
	<h2>NHL Game Reports</h2>
	<input class="w3-check" type="checkbox" onclick="selectAll()" name="allCk">
	<label>Most Reports</label><br>

	<input class="w3-check" type="checkbox" name="gsRptCk" checked>
	<label>Game Summary</label><br>

	<input class="w3-check" type="checkbox" name="esRptCk" >
	<label>Event Summary</label><br>

	<input class="w3-check" type="checkbox" name="plRptCk" >
	<label>Full Play-by-Play</label><br>

	<input class="w3-check" type="checkbox" name="fsRptCk" >
	<label>Face-off Summary</label><br>

	<input class="w3-check" type="checkbox" name="fcRptCk" >
	<label>Face-off Comparison</label><br>

	<input class="w3-check" type="checkbox" name="roRptCk" >
	<label>Roster Report</label><br>

	<input class="w3-check" type="checkbox" name="tvRptCk" >
	<label>TOI - Visitors</label><br>

	<input class="w3-check" type="checkbox" name="thRptCk" >
	<label>TOI - Home</label><br>

	<input class="w3-check" type="checkbox" name="ssRptCk" >
	<label>Shot Report</label><br>

	<input class="w3-check" type="checkbox" name="scRptCk" >
	<label>Shift Chart</label><br>

	<input class="w3-check" type="checkbox" name="soRptCk" >
	<label>Shootout Report</label><br><br>

</form>


	</div>
</div>

<script language=javascript>

function writeln( dataline ) {
	document.write( dataline + "<br>" );
}


var showScoresOn = true;
function isShowScoresOn() {
	return showScoresOn;
}

function toggleShowScores() {
	showScoresOn = document.forms["scoresToggle"]["showScores"].checked;
	rebuildGameList();
}

function padNumber( number ) {
	var numberString = number.toString();
	if( numberString.length == 1 ) {
		numberString = "0" + numberString;
	}
	return numberString;
}


function Get(yourUrl){
    var Httpreq = new XMLHttpRequest();
    Httpreq.open("GET",yourUrl,false);
    Httpreq.send(null);
    return Httpreq.responseText;
}


function eachGame( game, index ) {
	var season = game.gamePk.toString().substring( 0, 4 );
	var seasonPart = game.gamePk.toString().substring( 4, 6 );
	var gameNumber = game.gamePk.toString().substring( 6, 10 );
	var visitor = game.teams.away.team;
	var home = game.teams.home.team;

	if( isShowScoresOn() ) {
		htmlBuilder = htmlBuilder.concat( openGameAnchor( gameNumber ) );
		htmlBuilder = htmlBuilder.concat( gameNumber );
		htmlBuilder = htmlBuilder.concat( " - " );
		htmlBuilder = htmlBuilder.concat( visitor.name );
		htmlBuilder = htmlBuilder.concat( deriveScore( game ) );
		htmlBuilder = htmlBuilder.concat( home.name );
		htmlBuilder = htmlBuilder.concat( " - " );
		htmlBuilder = htmlBuilder.concat( deriveGameStatus( game ) );
		htmlBuilder = htmlBuilder.concat( closeGameAnchor() );
	} else {
		htmlBuilder = htmlBuilder.concat( openGameAnchor( gameNumber ) );
		htmlBuilder = htmlBuilder.concat( gameNumber );
		htmlBuilder = htmlBuilder.concat( " - " );
		htmlBuilder = htmlBuilder.concat( visitor.name );
		htmlBuilder = htmlBuilder.concat( " vs " );
		htmlBuilder = htmlBuilder.concat( home.name );
		htmlBuilder = htmlBuilder.concat( closeGameAnchor() );
	}
}


function clickGame( gameNo ) {
	document.forms["reports"]["gameNumber"].value = gameNo;
}


function openGameAnchor( gameNumber ) {
	var gameNo = parseInt( gameNumber );
	var startAnchor = "<p class=\"mb-compact w3-hover-pale-blue\" onclick=\"clickGame( " + gameNo.toString() + " )\">";
	return startAnchor;
}

function closeGameAnchor() {
	var endAnchor = "</p>";
	return endAnchor;
}


function deriveScore( game ) {
	var scoreTag;
	switch( game.status.statusCode ) {
	case "1":
	case "2":
	case "8":
	case "9":
		scoreTag = " vs ";
		break;
	case "3":
	case "4":
	case "5":
	case "6":
	case "7":
		scoreTag = " " + game.teams.away.score + " - " + game.teams.home.score + " ";
		break;
	}
	return scoreTag;
}


function deriveGameStatus( game ) {
	var statusTag;
	switch( game.status.statusCode ) {
	case "1":
	case "8":
		var gameTime = new Date( game.gameDate );
		statusTag = gameTime.toLocaleTimeString( 'en-US', { timeZoneName: 'short' } ).replace(/([\d]+:[\d]{2})(:[\d]{2})(.*)/, "$1$3");
		break;
	case "9":
		statusTag = "PPD";
		break;
	case "2":
		statusTag = "Pre-Game";
		break;
	case "3":
	case "4":
		statusTag = "Period " + game.linescore.currentPeriod + " (" + game.linescore.currentPeriodTimeRemaining + ")";
		break;
	case "5":
	case "6":
	case "7":
		statusTag = "Final";
		if( game.linescore.currentPeriod > 3 ) {
			statusTag = statusTag + " (" + game.linescore.currentPeriodOrdinal + ")";
		}
		break;
	}
	return statusTag;
}


var today = new Date();
var year = today.getFullYear().toString();
var month = ( today.getMonth() + 1 ).toString();
var day = today.getDate().toString();

month = padNumber( month );
day = padNumber( day );
var todayISO = ( year + "-" + month + "-" + day );

var nhlURL = "https://statsapi.web.nhl.com/api/v1/schedule?startDate=" + todayISO + "&endDate=" + todayISO + "&hydrate=linescore";
var schedule = JSON.parse( Get( nhlURL ) );

</script>

<p id="gameList"></p>

<script language=javascript>

var htmlBuilder = "";

function rebuildGameList() {
	checkedTag = isShowScoresOn() ? " checked " : "";
	htmlBuilder = "";
	htmlBuilder = htmlBuilder + "<h2>Today's Games</h2>";
	htmlBuilder = htmlBuilder + "<div class=\"w3-container\">";
	htmlBuilder = htmlBuilder + "<input class=\"w3-check\" type=\"checkbox\" name=\"showScores\"";
	htmlBuilder = htmlBuilder + checkedTag;
	htmlBuilder = htmlBuilder + "onclick=\"toggleShowScores()\">";
	htmlBuilder = htmlBuilder + "\n<label>Show scores</label>";

	var gameDate = schedule.dates[0];
	gameDate.games.forEach( eachGame );

	htmlBuilder = htmlBuilder + "</div>";

	document.getElementById("gameList").innerHTML = htmlBuilder;
}

rebuildGameList();

/* Game state codes
 * 1 - Preview
 * 2 - Preview
 * 3 - Live
 * 7 - Final
 *
 *
 * Game status codes
 * 1 - Scheduled
 * 2 - Pre-Game
 * 3 - In Progress
 * 7 - Final
 */



</script>

</body>
</html>
